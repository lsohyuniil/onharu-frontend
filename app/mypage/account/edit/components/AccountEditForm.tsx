"use client";

import { useForm, SubmitHandler } from "react-hook-form";
import Input from "@/components/ui/Input";
import { Button } from "@/components/ui/Button";
import { useEffect } from "react";
import { FormField } from "@/components/form-fields/FormField";
import { FIELD_CONFIG } from "@/components/form-fields/fieldConfig";

export type UserRole = "owner" | "child";

export interface EditForm {
  name: string;
  nickname?: string;
  phone: string;
  businessNumber?: string;
}

interface EditFormProps {
  defaultValues: EditForm;
  userRole: UserRole;
  onSubmit: SubmitHandler<EditForm>;
  serverNicknameError?: string;
}

export default function AccountEditForm({
  defaultValues,
  userRole,
  onSubmit,
  serverNicknameError,
}: EditFormProps) {
  const {
    register,
    handleSubmit,
    formState: { errors },
    setError,
  } = useForm<EditForm>({ defaultValues });

  useEffect(() => {
    if (serverNicknameError) {
      setError("nickname", { type: "server", message: serverNicknameError });
    }
  }, [serverNicknameError, setError]);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="mb-7.5 flex flex-col gap-2 sm:mb-12.5 sm:gap-5">
        <Input label="이메일" id="email" placeholder="test@test.com" disabled />

        <FormField<EditForm>
          name="name"
          config={FIELD_CONFIG.name}
          register={register}
          errors={errors}
        />

        {userRole === "child" && (
          <FormField<EditForm>
            name="nickname"
            config={FIELD_CONFIG.nickname}
            register={register}
            errors={errors}
          />
        )}

        <FormField<EditForm>
          name="phone"
          config={FIELD_CONFIG.phone}
          register={register}
          errors={errors}
        />

        {userRole === "owner" && (
          <Input
            label="사업자등록번호"
            id="businessNumber"
            placeholder={defaultValues.businessNumber || "사업자등록번호"}
            disabled
          />
        )}
      </div>

      <Button type="submit" varient="default" fontSize="md" width="lg" height="md">
        수정하기
      </Button>
    </form>
  );
}
